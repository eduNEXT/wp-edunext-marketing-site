'use strict';
window.ENEXT = window.ENEXT || {};

jQuery(document).ready(function ($) {

    ENEXT.checkCookie = function () {
        return document.cookie.indexOf(ENEXT_SRV.is_loggedin_cookie_name + '=true') !== -1;
    }

    ENEXT.getCookieInfo = function () {
        var user_cookie = document.cookie.split(';').filter(
            (item) => item.trim().startsWith(ENEXT_SRV.user_info_cookie_name));

        var user_cookie_info = user_cookie[0].split('=')[1]
        user_cookie_info = user_cookie_info.replace(/\\054/gi, ",");
        var json_data = JSON.parse(JSON.parse(user_cookie_info));
        return json_data;
    }

    ENEXT.renderMenu = function () {

        var user_data = ENEXT.getCookieInfo();
        var reg_exp = /__(?<value>\w+)__/
        $(".open-edx-link").each(function () {
            var item = $(this);
            item = item.children('a')[0];
            var replace_name = item.text.match(reg_exp);
            var replace_url = item.href.match(reg_exp);

            if (replace_name) {
                let new_name = replace_name.groups.value;
                item.text = user_data[new_name];
            }

            if (replace_url) {
                let new_url = replace_url.groups.value;
                item.href = user_data["header_urls"][new_url];
            }
        });
    }


    if (ENEXT.checkCookie()) {
        ENEXT.renderMenu();
    }
});