'use strict';
window.ENEXT = window.ENEXT || {};

ENEXT.OPENEDX_DOMAIN = ENEXT_SRV.lms_base_url;
ENEXT.LOGIN_NEXT = ENEXT_SRV.lms_wp_return_path;
ENEXT.LOGIN_PATH = ENEXT_SRV.lms_login_path;
ENEXT.RUN_FUNCTIONS = ENEXT_SRV.run_functions;


ENEXT.callMeAtOpenEdx = function() {
    return jQuery.ajax({
        url: ENEXT.OPENEDX_DOMAIN + "/api/user/v1/me",
        method: "GET",
        xhrFields: {
            withCredentials: true
        }
    })
}

ENEXT.assertOpenEdxLoggedIn = function() {
    ENEXT.callMeAtOpenEdx().fail(function(xhr) {
        window.location.replace(ENEXT.OPENEDX_DOMAIN + "/" + ENEXT.LOGIN_PATH + "?next=" + ENEXT.LOGIN_NEXT);
    });
};

// Run the defined functions
for (var i = ENEXT.RUN_FUNCTIONS .length - 1; i >= 0; i--) {
    ENEXT[ENEXT.RUN_FUNCTIONS[i]]();
}
