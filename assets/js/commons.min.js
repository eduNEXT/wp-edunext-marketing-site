'use strict';
window.ENEXT = window.ENEXT || {};

ENEXT.OPENEDX_DOMAIN = ENEXT_SRV.lms_base_url;
ENEXT.ENROLLMENT_API_LOCATION = ENEXT.OPENEDX_DOMAIN + ENEXT_SRV.enrollment_api_location;

ENEXT.getEnrollmentInfo = function() {
    var urlEnrollments = ENEXT.ENROLLMENT_API_LOCATION + 'enrollment';
    return jQuery.ajax({
        url: urlEnrollments,
        type: 'GET',
        dataType: 'json',
        xhrFields: {
            withCredentials: true
        }
    });
}

ENEXT.getCourseData = function(courseID) {
    var urlCourse = ENEXT.ENROLLMENT_API_LOCATION + 'course/' + courseID + '?include_expired=1';
    return jQuery.ajax({
        url: urlCourse,
        type: 'GET',
        dataType: 'json',
        xhrFields: {
            withCredentials: true
        }
    });
}

ENEXT.amILoggedIn = function() {
    return document.cookie.indexOf(ENEXT_SRV.is_loggedin_cookie_name + '=true') !== -1;
}

ENEXT.amIEnrolledIn = function (enrollmentData, courseID) {
    return Boolean(jQuery.grep(enrollmentData, function(row) {
        return row['course_details']['course_id'] == courseID
    }).length);
}

ENEXT.isCourseRegistrationOpen = function(courseData) {
    return (new Date(Date.parse(courseData.enrollment_start) || Date.now()) <= Date.now()) &&
        (Date.now() <= new Date(Date.parse(courseData.enrollment_end) || Date.now()))
}
